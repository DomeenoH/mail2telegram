# AI 邮件总结优化技术文档

本指南记录了 `mail2telegram` 项目中 AI 总结功能的重大优化。

## 1. Prompt 优化 (Chinese First)
将原有的英文指令替换为强力中文指令，确保即使面对英文邮件，AI 也能生成地道的中文摘要。

- **系统提示词**：定义为“专业的邮件总结助手”，强化对中文输出的强制要求。
- **用户指令**：明确要求提取核心内容，并使用 Markdown 列表格式（`**加粗**` 和 `*` 列表）输出。

## 2. 模型选型优化 (Gemma-3-12b)
为了平衡生成的准确度与 Worker 的执行效率，我们进行了以下调整：
- **弃用老旧模型**：Llama-3-8b 和已被弃用的 Qwen1.5。
- **启用现代模型**：更新为 **`@cf/google/gemma-3-12b-it`**。
  - **优势**：支持 128k 上下文，多语言能力极强，响应速度快，且在 Cloudflare 免费额度内。

## 3. Telegram 渲染容错机制 (Markdown Fail-safe)
针对 Telegram 对 Markdown 格式校验过于严格的问题（如地址中的下划线导致消息更新失败），我们实现了自动降级逻辑：
- **Markdown 尝试**：首选 `parse_mode: 'Markdown'` 渲染美观的消息格式。
- **优雅回退**：若 API 报告格式错误（400），系统会自动剥离格式参数并重新以纯文本提交消息，确保总结内容 100% 可达。

## 4. 部署与配置
在 `wrangler.jsonc` 中通过 `WORKERS_AI_MODEL` 变量灵活配置模型，通过 `SUMMARY_TARGET_LANG` 控制目标语言。
